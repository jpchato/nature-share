{% extends 'base.html' %}
{% block content %}
{% load static %}
<!-- REFERENCES -->
<!-- https://developers.google.com/maps/documentation/javascript/adding-a-google-map#all -->


<script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4sW1Mx3HChvgQYV4kxTk09lqvXwK6Wo0&callback=initMap&libraries=&v=weekly"
      async defer
    ></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    coordinates = '{{organism.location}}'
    var partsOfStr = coordinates.split(',');
    lat = parseInt(parseFloat(partsOfStr[0]))
    lon = parseInt(parseFloat(partsOfStr[1]))
    cleanCoordinates = lat.toFixed(6) + ',' + lon.toFixed(6)
    function initialize(){
        // var myLatlng = new google.maps.LatLng(-25.363882,131.044922);
        // var myLatlng = new google.maps.LatLng('{{organism.location}}');
        var myLatlng = new google.maps.LatLng(lat,lon);
        var myOptions = {
            zoom: 10,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
            }
        map = new google.maps.Map(document.getElementById("map"), myOptions);
        var marker = new google.maps.Marker({
            position: myLatlng, 
            map: map,
        title:"Fast marker"
        });
    } 
    google.maps.event.addDomListener(window,'load', initialize);
</script>

<link rel="stylesheet" type="text/css" href="{% static 'natureShareApp/organism_detail.css' %}">

<section>
<div id = 'app'>
    <h1>{{ organism.name }}</h1>
    <img src="{{ organism.picture.url }}" /> 
    <p>edible: {{ organism.edibility }}</p>
    <p>ecosystem: {{ organism.ecosystem }}</p>
    <p>[[ ecosystem_summary ]]</p>
    <p>weather: {{ organism.weather }}</p>
    <p>date: {{ organism.date }}</p>
    <p>Latitude and Longitude: {{ organism.location }}</p>
    <p>Uploaded by {{organism.user}} </p>
    {% if user == organism.user %}
    <a href="http://127.0.0.1:8000/{{organism.id}}/update">Edit Organism</a><br>
    <a href="http://127.0.0.1:8000/{{organism.id}}/delete">Delete Organism</a>
    {% endif %}
</div>
</section>


<div id="map">
</div>



<script> 
    organismEcosystem = '{{organism.ecosystem}}'
    var app = new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            ecosystem_summary: '',
            weather_summary: '',
            
        },
        mounted:  async function(event){
            if (organismEcosystem != 'None' && organismEcosystem != 'Unknown' && organismEcosystem != 'Other'){
                let response = await axios.get('https://en.wikipedia.org/api/rest_v1/page/summary/{{organism.ecosystem}}');
                this.ecosystem_summary = response.data.extract;
            }
            let weather_response = await axios.get('https://en.wikipedia.org/api/rest_v1/page/summary/{{organism.weather}}');
            this.weather_summary = weather_response.data.extract;
        },
    })
</script>

{% endblock %}